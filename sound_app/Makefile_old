# sudo apt-get install libopus-dev libavresample-dev libswresample-dev libspeexdsp-dev


# CROSS_COMPILE:=arm-linux-gnueabihf-
CROSS_COMPILE := /opt/fsl-imx-x11/4.1.15-2.1.0/sysroots/x86_64-pokysdk-linux/usr/bin/arm-poky-linux-gnueabi/arm-poky-linux-gnueabi-


objs := sound_app.o aplay.o record.o opus.o ipc_udp.o


INCLUDES +=  -I./
INCLUDES +=  -I/opt/fsl-imx-x11/4.1.15-2.1.0/sysroots/cortexa7hf-neon-poky-linux-gnueabi/usr/include

CPPFLAGS += -mfloat-abi=soft
CPPFLAGS += $(INCLUDES)

app = sound_app
all: ${app}
${app}: $(objs)
	${CROSS_COMPILE}g++ $(CPPFLAGS) -o $@ $^ -lasound -pthread -lopus -lspeexdsp


# 需要判断是否存在依赖文件
# .main.o.d .sub.o.d
dep_files := $(foreach f, $(objs), .$(f).d)
dep_files := $(wildcard $(dep_files))

# 把依赖文件包含进来
ifneq ($(dep_files),)
  include $(dep_files)
endif


%.o : %.c
	${CROSS_COMPILE}gcc $(CPPFLAGS) -Wp,-MD,.$@.d -g -c -o $@  $<

%.o : %.cpp
	${CROSS_COMPILE}g++ $(CPPFLAGS) -Wp,-MD,.$@.d -g -c -o $@  $<

clean:
	rm *.o ${app} -f

distclean:
	rm  $(dep_files) *.o ${app} -f

opus_test: opus.cpp
	g++ -DTEST $(CPPFLAGS) -o $@ $^ -lopus  -lspeexdsp
